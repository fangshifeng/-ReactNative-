# 《ReactNative系列讲义》高级篇---06.热更新思路讲解

**|** 版权声明：本文为博主原创文章，未经博主允许不得转载。

#### 一、简介
热更新技术是ReactNative框架的一大特色。简单的说，热更新技术就是在无需用户重新下载APP SDK的情况下，更新已安装的APP除Native之外的功能，并且绝大部分情况是在用户不知道的状态下更新成功。最常见的使用场景就是一些电商类的APP在活动日替换符合活动日主题的页面，新增功能（不涉及Native功能）等等。也常用于解决APP现存的一些bug，不必频繁的发布新版本。热更新技术也是ReactNative框架备受关注的原因之一。本篇博客只为大家讲解一下Android端的热更新实现，iOS平台有着它独有的特殊性，暂时不讲。

#### 二、思路分析
首先抛出热更新的实现思路：用户每次打开APP客户端，在APP启动的过程中请求服务器获取最新bundle版本号，同时从本地获取当前已安装APP的bundle版本号，将两者进行对比，如若一致，则无需更新继续执行其他逻辑；如果不一致，从服务器获取当前最新版本的bundle包下载到本地。解压缩最新版本的bundle包（服务器端存放的bundle包一般均为压缩文件）。如果采用全量更新方法，解压缩之后的bundle文件可直接使用；如果使用的是差量更新方法，解压缩之后还需要与当前本地使用的bundle包进行合并，合并成功之后方可使用。这里还有一个隐藏的技术点：修改ReactNative默认读取加载bundle包的路径，将之改成你自定义的bundle包路径。也就是你解压新bundle包的路径（全量更新方法）或你合并bundle包的路径（差量更新方法）。最后是查看APP的更新效果，如果是冷加载，必须是在APP被彻底杀死，重新启动之后才能看到；如果是热加载，调用ReactNative重新加载bundle方法。这里暂时只讲冷加载。

#### 三、思路节点分析
1. 创建服务器
2. 封装Android平台ReactNative的Native Module技术。包含：

* 当前bundle版本提取；
* 获取服务器端bundle版本号；
* 文件或者目录的创建；
* bundle文件下载；
* bundle文件解压缩；
* bundle文件与差量包的合并；
* 文件的删除等等。


#### 四、技术节点分析
* JAVA IO流操作；
* Android的BuildConfig操作；（参考URL：http://blog.csdn.net/aotian16/article/details/51776051）
* 文件操作：解压缩，取差量，合并；
* RN手动打包；
* RN打包的文件中包含：RN源码，第三方库，业务逻辑代码；
* RN的运行机制；
* 修改ReactNative读取bundle文件的路径；




